# coding: utf-8

#
# Copyright 2014-2017 Groupon, Inc.
# Copyright 2014-2017 The Billing Project, LLC
#
# The Billing Project, LLC licenses this file to you under the Apache License, version 2.0
# (the "License"); you may not use this file except in compliance with the
# License.  You may obtain a copy of the License at:
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
# License for the specific language governing permissions and limitations
# under the License.
#

"""
    Kill Bill

    Kill Bill is an open-source billing and payments platform  # noqa: E501

    OpenAPI spec version: 1.0.0
    
    Generated by: https://github.com/swagger-api/swagger-codegen.git
"""


from __future__ import absolute_import

import unittest

import killbill
from killbill.models.account import Account  # noqa: E501
from killbill.models.tenant import Tenant  # noqa: E501
from killbill.models.payment_method import PaymentMethod  # noqa: E501
from killbill.models.subscription import Subscription  # noqa: E501
from killbill.models.invoice_dry_run import InvoiceDryRun  # noqa: E501
from killbill.rest import ApiException



class TestIntegration(unittest.TestCase):
    """Account unit test stubs"""

    def setUp(self):
        pass

    def tearDown(self):
        pass

    def test_integration(self):

        # Create tenant
        # TODO WORKING WITH ISSUES*! [ValueError: Invalid value for `api_key`, must not be `None`]
        tenant = killbill.api.TenantApi()
        body = Tenant(api_key='bob_5', api_secret='lazar_5')
        tenant.create_tenant(body, 'test')

        # Get tenant
        # TODO NOT WORKING! [ApiException: (401) Reason: Unauthorized] or [ValueError: Invalid value for `api_secret`, must not be `None`]
        body = Tenant(api_key='bob')
        tenant.get_tenant_by_api_key(body)

        # Upload XML catalog/Fetch XML catalog
        # TODO NOT WORKING! [ApiException: (404) Reason: Not Found]
        catalog = killbill.api.CatalogApi()
        xml_catalog = open("/home/jfrodriguez/Documents/KillBill-Docs/SpyCarBasic.xml", "r+").read()
        catalog.upload_catalog_xml(xml_catalog, 'test', 'bob', 'lazar')

        # Create account
        # WORKING!
        account = killbill.api.AccountApi()
        body = Account(name='Johny', currency='USD', state='CA', country='USA')
        account.create_account(body, 'test', 'bob', 'lazar')

        # Get account
        # TODO NOT WORKING! [AttributeError: 'module' object has no attribute 'Str']
        account = account.get_account_by_key('test_external_key', 'bob', 'lazar')
        account = account.get_account('4eba7df9-f023-4425-bb46-b1a2e6e84fea', 'bob', 'lazar')

        # Add a payment method
        # WORKING!
        account = killbill.api.AccountApi()
        account_id = 'b506e9bc-0afd-495c-a047-a1eada0599be'
        body = PaymentMethod(plugin_name='__EXTERNAL_PAYMENT__', plugin_info=None)
        account.create_payment_method(account_id, body, 'test', 'bob', 'lazar')

        # Get a payment method
        # TODO NOT WORKING! [AttributeError: 'module' object has no attribute 'List[PaymentMethod]']
        account.get_payment_methods_for_account(account_id, 'bob', 'lazar')

        # Tag account as AUTO_INVOICING_OFF
        # TODO NOT WORKING! [Bad Request: POST http://localhost:8080/1.0/kb/accounts/b506e9bc-0afd-495c-a047-a1eada0599be/tags?tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=-&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=-&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=-&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=-&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=0&tagDef=2]
        account_id = 'b506e9bc-0afd-495c-a047-a1eada0599be'
        account.create_account_tags(account_id, 'test', 'bob', 'lazar')

        # Create a subscription against plan
        # TODO NOT WORKING! [ValueError: Invalid value for `product_name`, must not be `None`]
        subscription = killbill.api.SubscriptionApi()
        body = Subscription(account_id='4eba7df9-f023-4425-bb46-b1a2e6e84fea',
                            plan_name='sports-monthly',
                            product_name='Basic',
                            billing_period='MONTHLY',
                            price_list='DEFAULT')
        subscription.create_subscription(body, 'test', 'bob', 'lazar')

        pass


if __name__ == '__main__':
    unittest.main()
